import os
import pandas as pd
import random

# ----------------------------------------------------------------------
# 1. íš¨ëŠ¥ í‚¤ì›Œë“œ ì‚¬ì „ (product_type â†’ ê´€ë ¨ ì§ˆì˜ì–´)
# ----------------------------------------------------------------------
PRODUCT_TYPE_KEYWORDS = {
    "ì†Œì—¼Â·ì§„í†µì œ": ["ì†Œì—¼ íš¨ê³¼ê°€ ìˆëŠ” ì„±ë¶„", "í†µì¦ ì™„í™” ì•½ë¬¼", "ì—¼ì¦ ì–µì œ ì„±ë¶„", "ì§„í†µ ì‘ìš© ë¬¼ì§ˆ"],
    "í•´ì—´Â·ì§„í†µì œ": ["ì—´ì„ ë‚´ë¦¬ëŠ” ì„±ë¶„", "í•´ì—´ íš¨ê³¼ê°€ ìˆëŠ” ì•½ë¬¼", "ì§„í†µ íš¨ê³¼ê°€ ìˆëŠ” ì„±ë¶„"],
    "í•­íˆìŠ¤íƒ€ë¯¼ì œ": ["ì•Œë ˆë¥´ê¸° ì™„í™” ì„±ë¶„", "ë¹„ì—¼ì— ì“°ì´ëŠ” ì•½ë¬¼", "ê°€ë ¤ì›€ ì–µì œ ì•½ë¬¼"],
    "ê¸°íƒ€ìˆ˜ì•¡ì œ": ["ì²´ì•¡ ë³´ì¶© ì„±ë¶„", "ìˆ˜ë¶„ ê³µê¸‰ ì•½ë¬¼", "ì „í•´ì§ˆ ê· í˜• ìœ ì§€ ì„±ë¶„"],
    "ê°•ì‹¬ì œ": ["ì‹¬ì¥ ê¸°ëŠ¥ ê°•í™” ì„±ë¶„", "ì‹¬ë¶€ì „ ì¹˜ë£Œì— ì“°ì´ëŠ” ì•½ë¬¼", "ì‹¬ê·¼ ìˆ˜ì¶•ì„ ë•ëŠ” ì„±ë¶„"],
    "ì •ì¥ì œ": ["ì¥ ìš´ë™ì„ ì¡°ì ˆí•˜ëŠ” ì„±ë¶„", "ì†Œí™” ê¸°ëŠ¥ ê°œì„  ì•½ë¬¼", "ìœ ì‚°ê·  ê´€ë ¨ ì œì œ"],
    "í•­ìƒì œ": ["ì„¸ê·  ê°ì—¼ ì¹˜ë£Œ ì„±ë¶„", "í•­ê·  ì‘ìš©ì´ ìˆëŠ” ì•½ë¬¼", "ê°ì—¼ ì–µì œ ì•½ë¬¼"],
    "í˜ˆì••ê°•í•˜ì œ": ["í˜ˆì••ì„ ë‚®ì¶”ëŠ” ì„±ë¶„", "ê³ í˜ˆì•• ì¹˜ë£Œì œì˜ ì£¼ì„±ë¶„", "í˜ˆê´€ì„ í™•ì¥í•˜ëŠ” ì•½ë¬¼"],
    "ì§„í•´ê±°ë‹´ì œ": ["ê¸°ì¹¨ì„ ì™„í™”í•˜ëŠ” ì„±ë¶„", "ê°€ë˜ë¥¼ ì œê±°í•˜ëŠ” ì•½ë¬¼", "í˜¸í¡ê¸° ì™„í™” ì„±ë¶„"],
}

# ----------------------------------------------------------------------
# 2. íŒŒì¼ ê²½ë¡œ ì„¤ì •
# ----------------------------------------------------------------------
base_dir = os.path.dirname(os.path.abspath(__file__))
data_dir = os.path.join(base_dir, "../data")

input_csv = os.path.join(data_dir, "drug_product_type_ingredients_similarity_train.csv")
output_csv = os.path.join(data_dir, "drug_product_type_ingredients_augmented_train.csv")

# ----------------------------------------------------------------------
# 3. CSV ë¡œë“œ
# ----------------------------------------------------------------------
df = pd.read_csv(input_csv)
print(f"âœ… Loaded {len(df)} base samples")

# ----------------------------------------------------------------------
# 4. ì§ˆì˜-ë¬¸ë§¥ ìŒ ìƒì„±
# ----------------------------------------------------------------------
rows = []
for _, row in df.iterrows():
    ptype = str(row["product_type"]).strip()
    ingredient = str(row["ingredient_name"]).strip()
    context = str(row["description"]).strip()

    keywords = PRODUCT_TYPE_KEYWORDS.get(ptype, [f"{ptype}ì˜ ì£¼ìš” ì„±ë¶„"])
    for q in random.sample(keywords, min(3, len(keywords))):  # ìµœëŒ€ 3ê°œ ìƒ˜í”Œë§
        rows.append({
            "query": q,
            "context": context,
            "label": 1.0,
            "product_type": ptype,
            "ingredient_name": ingredient
        })

aug_df = pd.DataFrame(rows)
print(f"ğŸš€ Generated {len(aug_df)} augmented samples")

# ----------------------------------------------------------------------
# 5. ì €ì¥
# ----------------------------------------------------------------------
aug_df.to_csv(output_csv, index=False)
print(f"âœ… Saved â†’ {output_csv}")